<!-- Come√ßo do HTML completo -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üìã Inscri√ß√£o Di√°rio INS DUO</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f9f9f9; padding:20px; max-width:600px; margin:auto; color:#222; }
    h2 { text-align:center; margin-bottom:20px; }
    label { display:block; margin-top:15px; font-weight:bold; }
    input, select, button { width:100%; padding:10px; margin-top:5px; box-sizing:border-box; border-radius:6px; border:1px solid #ccc; font-size:16px; }
    button { background:#007bff; color:#fff; cursor:pointer; }
    button:hover:not(:disabled) { background:#0056b3; }
    .horario-btn {
      display:block;
      margin-top:10px;
      padding:10px;
      font-weight:bold;
      text-align:left;
      border:none;
      border-radius:6px;
      cursor:pointer;
      transition: background-color 0.2s;
      user-select:none;
    }
    .horario-btn.available { background:#e0ffe0; color:#000; }
    .horario-btn.selected { background:#ffcc80; color:#000; }
    .horario-btn.lotado { background:#ffdddd; color:red; cursor:not-allowed; }
    .comprovante, .painel {
      background:#fff;
      padding:15px;
      border-radius:8px;
      margin-top:20px;
      box-shadow:0 0 8px rgba(0,0,0,0.1);
    }
    .btn-excluir {
      background:#dc3545;
      color:#fff;
      border:none;
      padding:6px 12px;
      border-radius:5px;
      margin-top:10px;
      cursor:pointer;
      font-weight:bold;
    }
    .btn-excluir:hover { background:#b02a37; }
    .btn-limpar {
      background:#dc3545;
      color:#fff;
      padding:12px;
      margin-top:15px;
      width:100%;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
    }
    .btn-limpar:hover { background:#b02a37; }
    .inscricao-item {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
      margin-bottom: 10px;
    }
    .inscricao-item div {
      margin: 3px 0;
    }
  </style>
</head>
<body>

<h2>üìã DI√ÅRIO INSOLENTES - MODO DUO</h2>

<div>
  <label>Nick 1:</label>
  <input type="text" id="nick1" maxlength="30" />
  <label>Nick 2:</label>
  <input type="text" id="nick2" maxlength="30" />
  <label>WhatsApp (11 d√≠gitos):</label>
  <input type="text" id="whatsapp" maxlength="11" oninput="this.value=this.value.replace(/\D/g,'')" />

  <label style="margin-top:20px;">Escolha os hor√°rios:</label>
  <div id="horariosArea"></div>
  <p><b>Total: R$ <span id="valorTotal">0</span>,00</b></p>

  <!-- LINK DE PAGAMENTO ATUALIZADO -->
  <p><b>Pagamento:</b></p>
  <a id="linkPagamento" href="https://mpago.la/1JPi8Cq" target="_blank" style="color:#007bff;">Clique aqui para pagar</a>

  <button id="btnConfirmar">‚úÖ Confirmar Pagamento</button>
</div>

<div class="comprovante" id="comprovanteFinal" style="display:none;"></div>

<!-- Painel ADM -->
<div class="painel">
  <h3>üîê Painel ADM</h3>
  <input type="password" id="senhaADM" placeholder="Senha do ADM" />
  <button id="btnEntrarADM">Entrar</button>
  <div id="painelArea" style="display:none; margin-top:20px;">
    <h4>Filtrar por hor√°rio:</h4>
    <select id="filtroHorario">
      <option value="">-- Todos --</option>
      <option value="19:00">19:00</option>
      <option value="20:00">20:00</option>
      <option value="21:00">21:00</option>
    </select>
    <div id="listaInscricoes" style="margin-top:15px;"></div>

    <h4>Links por hor√°rio:</h4>
    <label>Link 19:00</label>
    <input type="text" id="link19" />
    <label>Link 20:00</label>
    <input type="text" id="link20" />
    <label>Link 21:00</label>
    <input type="text" id="link21" />
    <button id="btnSalvarLinks">üíæ Salvar Links</button>

    <button class="btn-limpar" id="btnLimparInscricoes">üóëÔ∏è Apagar todas inscri√ß√µes</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getDatabase, ref, push, onValue, remove, set, get } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCDG1XlsNYrBkcJFQaxztV-g_f5KmWKTKQ",
    authDomain: "diaroins.firebaseapp.com",
    databaseURL: "https://diaroins-default-rtdb.firebaseio.com",
    projectId: "diaroins",
    storageBucket: "diaroins.firebasestorage.app",
    messagingSenderId: "496629295432",
    appId: "1:496629295432:web:ec32adceccd3e2d8162b7d",
    measurementId: "G-47GHPMMC59"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const SENHA_ADM = "2734";
  const VALOR_POR_HORA = 3;
  const VAGAS_INICIAIS = 24;

  let inscritos = {};
  let links = {
    "19:00": "https://exemplo.com/19",
    "20:00": "https://exemplo.com/20",
    "21:00": "https://exemplo.com/21"
  };

  let vagasDisponiveis = { "19:00": VAGAS_INICIAIS, "20:00": VAGAS_INICIAIS, "21:00": VAGAS_INICIAIS };
  let selecionados = [];

  async function carregarLinks() {
    try {
      const snapshot = await get(ref(db, "links"));
      if(snapshot.exists()) {
        links = snapshot.val();
      }
      document.getElementById('link19').value = links["19:00"] || "";
      document.getElementById('link20').value = links["20:00"] || "";
      document.getElementById('link21').value = links["21:00"] || "";
    } catch(e) {
      console.error("Erro ao carregar links:", e);
    }
  }

  async function salvarLinks() {
    links["19:00"] = document.getElementById('link19').value.trim();
    links["20:00"] = document.getElementById('link20').value.trim();
    links["21:00"] = document.getElementById('link21').value.trim();
    try {
      await set(ref(db, "links"), links);
      alert("Links salvos com sucesso!");
    } catch(e) {
      alert("Erro ao salvar links");
      console.error(e);
    }
  }

  function atualizarVagas() {
    vagasDisponiveis = { "19:00": VAGAS_INICIAIS, "20:00": VAGAS_INICIAIS, "21:00": VAGAS_INICIAIS };
    Object.values(inscritos).forEach(i => {
      i.horarios.forEach(h => {
        if (vagasDisponiveis[h] > 0) vagasDisponiveis[h]--;
      });
    });
  }

  function renderHorarios() {
    atualizarVagas();
    const area = document.getElementById('horariosArea');
    area.innerHTML = '';
    for (const h in vagasDisponiveis) {
      let vagas = vagasDisponiveis[h];
      const btn = document.createElement('button');
      btn.type = "button";

      if (selecionados.includes(h)) {
        vagas = vagas - 1;
        btn.className = 'horario-btn selected';
      } else {
        btn.className = 'horario-btn available';
      }

      if (vagas <= 0) {
        btn.textContent = `${h} (LOTOU)`;
        btn.className = 'horario-btn lotado';
        btn.disabled = true;
      } else {
        btn.textContent = `${h} (${vagas} vagas)`;
        btn.disabled = false;
      }

      btn.onclick = () => {
        if (selecionados.includes(h)) {
          selecionados = selecionados.filter(x => x !== h);
        } else {
          if (vagasDisponiveis[h] > 0) {
            selecionados.push(h);
          }
        }
        renderHorarios();
        atualizarValorTotal();
        atualizarLinkPagamento();
      };

      area.appendChild(btn);
    }
    atualizarValorTotal();
  }

  function atualizarValorTotal() {
    document.getElementById('valorTotal').textContent = selecionados.length * VALOR_POR_HORA;
  }

  // ‚úÖ FUN√á√ÉO ATUALIZADA COM OS LINKS DE PAGAMENTO CORRETOS
  function atualizarLinkPagamento() {
    const link = document.getElementById('linkPagamento');
    const valorTotal = selecionados.length * VALOR_POR_HORA;

    if (valorTotal === 0) {
      link.textContent = 'Clique aqui para pagar';
      link.href = 'https://mpago.la/1JPi8Cq';
    } else if (valorTotal === 3) {
      link.textContent = 'Pagar R$ 3,00';
      link.href = 'https://mpago.la/1JPi8Cq';
    } else if (valorTotal === 6) {
      link.textContent = 'Pagar R$ 6,00';
      link.href = 'https://mpago.la/196kFhN';
    } else if (valorTotal === 9) {
      link.textContent = 'Pagar R$ 9,00';
      link.href = 'https://mpago.la/2vo1T6X';
    } else {
      link.textContent = 'Valor inv√°lido';
      link.href = '#';
    }
  }

  async function confirmarInscricao() {
    const nick1 = document.getElementById('nick1').value.trim();
    const nick2 = document.getElementById('nick2').value.trim();
    const whatsapp = document.getElementById('whatsapp').value.trim();

    if (!nick1 || !nick2 || whatsapp.length !== 11 || selecionados.length === 0) {
      alert('Preencha todos os campos corretamente.');
      return;
    }

    const data = new Date();
    const nova = {
      nick1,
      nick2,
      whatsapp,
      horarios: [...selecionados],
      dia: data.toLocaleDateString(),
      hora: data.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
    };

    try {
      await push(ref(db, "inscritos"), nova);
      alert("Inscri√ß√£o confirmada com sucesso!");
      selecionados = [];
      document.getElementById('nick1').value = '';
      document.getElementById('nick2').value = '';
      document.getElementById('whatsapp').value = '';
      renderHorarios();
      atualizarLinkPagamento();
      mostrarComprovante(nova);
    } catch(e) {
      alert("Erro ao confirmar inscri√ß√£o");
      console.error(e);
    }
  }

  function mostrarComprovante(dados) {
    const div = document.getElementById('comprovanteFinal');
    let html = `<h4>üéâ Inscri√ß√£o Confirmada</h4>`;
    html += `<p><b>Nick 1:</b> ${dados.nick1}</p>`;
    html += `<p><b>Nick 2:</b> ${dados.nick2}</p>`;
    html += `<p><b>WhatsApp:</b> ${dados.whatsapp}</p>`;
    html += `<p><b>Data:</b> ${dados.dia}</p>`;
    html += `<p><b>Hora:</b> ${dados.hora}</p>`;
    html += `<p><b>Links para Grupo (ID e SENHA):</b></p><ul>`;
    dados.horarios.forEach(h => {
      html += `<li>Grupo ${h} (<a href="${links[h]}" target="_blank">link</a>)</li>`;
    });
    html += `</ul><p><b>üì∏ Tire print desta tela. Este √© seu comprovante.</b></p>`;
    div.innerHTML = html;
    div.style.display = 'block';
    div.scrollIntoView({behavior:"smooth"});
  }

  function carregarInscritos() {
    const inscritosRef = ref(db, "inscritos");
    onValue(inscritosRef, (snapshot) => {
      inscritos = snapshot.val() || {};
      renderHorarios();
      mostrarInscricoesADM();
    });
  }

  function entrarADM() {
    const senha = document.getElementById('senhaADM').value.trim();
    if (senha === SENHA_ADM) {
      document.getElementById('painelArea').style.display = 'block';
      document.getElementById('senhaADM').value = '';
      carregarLinks();
      carregarInscritos();
    } else {
      alert('Senha incorreta');
    }
  }

  function mostrarInscricoesADM() {
    const filtro = document.getElementById('filtroHorario').value;
    const lista = document.getElementById('listaInscricoes');
    lista.innerHTML = '';

    const inscritosArray = Object.entries(inscritos).map(([key, val]) => ({key, ...val}));
    const filtrados = filtro ? inscritosArray.filter(i => i.horarios.includes(filtro)) : inscritosArray;

    if (filtrados.length === 0) {
      lista.innerHTML = '<p>Nenhuma inscri√ß√£o.</p>';
      return;
    }

    filtrados.forEach(i => {
      const div = document.createElement('div');
      div.className = 'inscricao-item';
      div.innerHTML = `
        <div><b>Slot:</b> ${i.horarios.join(', ')}</div>
        <div><b>Nick 1:</b> ${i.nick1}</div>
        <div><b>Nick 2:</b> ${i.nick2}</div>
        <div><b>WhatsApp:</b> ${i.whatsapp}</div>
        <button class="btn-excluir" onclick="excluirInscricao('${i.key}')">Excluir</button>
      `;
      lista.appendChild(div);
    });
  }

  async function excluirInscricao(id) {
    if (!confirm("Confirma exclus√£o desta inscri√ß√£o?")) return;
    try {
      await remove(ref(db, `inscritos/${id}`));
      alert("Inscri√ß√£o removida!");
      carregarInscritos();
    } catch(e) {
      alert("Erro ao remover inscri√ß√£o");
      console.error(e);
    }
  }

  async function limparInscricoes() {
    if (!confirm("Deseja apagar todas as inscri√ß√µes? Esta a√ß√£o n√£o pode ser desfeita.")) return;
    try {
      await remove(ref(db, "inscritos"));
      alert("Todas inscri√ß√µes apagadas!");
      carregarInscritos();
      document.getElementById('comprovanteFinal').style.display = 'none';
    } catch(e) {
      alert("Erro ao apagar inscri√ß√µes");
      console.error(e);
    }
  }

  window.confirmarInscricao = confirmarInscricao;
  window.entrarADM = entrarADM;
  window.salvarLinks = salvarLinks;
  window.limparInscricoes = limparInscricoes;
  window.excluirInscricao = excluirInscricao;
  window.mostrarInscricoesADM = mostrarInscricoesADM;

  document.getElementById('btnConfirmar').addEventListener('click', confirmarInscricao);
  document.getElementById('btnEntrarADM').addEventListener('click', entrarADM);
  document.getElementById('btnSalvarLinks').addEventListener('click', salvarLinks);
  document.getElementById('btnLimparInscricoes').addEventListener('click', limparInscricoes);
  document.getElementById('filtroHorario').addEventListener('change', mostrarInscricoesADM);

  carregarLinks();
  carregarInscritos();
  renderHorarios();
  atualizarLinkPagamento();
</script>

</body>
  </html>
